<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AceTime: ace_time::clock::SystemClock Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AceTime
   &#160;<span id="projectnumber">0.5.1</span>
   </div>
   <div id="projectbrief">Date and time classes for Arduino that support timezones from the TZ Database, and a system clock that can synchronize from an NTP server or an RTC chip.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>ace_time</b></li><li class="navelem"><b>clock</b></li><li class="navelem"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html">SystemClock</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classace__time_1_1clock_1_1SystemClock-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ace_time::clock::SystemClock Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A <a class="el" href="classace__time_1_1clock_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user.  
 <a href="classace__time_1_1clock_1_1SystemClock.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ace_time::clock::SystemClock:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1clock_1_1SystemClock__inherit__graph.png" border="0" usemap="#ace__time_1_1clock_1_1SystemClock_inherit__map" alt="Inheritance graph"/></div>
<map name="ace__time_1_1clock_1_1SystemClock_inherit__map" id="ace__time_1_1clock_1_1SystemClock_inherit__map">
<area shape="rect" id="node2" href="classace__time_1_1clock_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="10,80,202,107"/>
<area shape="rect" id="node3" href="classace__time_1_1clock_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="7,5,205,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ace_time::clock::SystemClock:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1clock_1_1SystemClock__coll__graph.png" border="0" usemap="#ace__time_1_1clock_1_1SystemClock_coll__map" alt="Collaboration graph"/></div>
<map name="ace__time_1_1clock_1_1SystemClock_coll__map" id="ace__time_1_1clock_1_1SystemClock_coll__map">
<area shape="rect" id="node2" href="classace__time_1_1clock_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="10,80,202,107"/>
<area shape="rect" id="node3" href="classace__time_1_1clock_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="7,5,205,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a06a954f7d73ec2ad3138f38fcd8889d2"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a06a954f7d73ec2ad3138f38fcd8889d2">SystemClock</a> (<a class="el" href="classace__time_1_1clock_1_1TimeProvider.html">TimeProvider</a> *syncTimeProvider, <a class="el" href="classace__time_1_1clock_1_1TimeKeeper.html">TimeKeeper</a> *backupTimeKeeper)</td></tr>
<tr class="separator:a06a954f7d73ec2ad3138f38fcd8889d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d9d0d7e3bbf66b45cf6010df983c6c2"><td class="memItemLeft" align="right" valign="top"><a id="a8d9d0d7e3bbf66b45cf6010df983c6c2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup</b> ()</td></tr>
<tr class="separator:a8d9d0d7e3bbf66b45cf6010df983c6c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adfc9d74fc2b9a0356a44d1e41845b3de"><td class="memItemLeft" align="right" valign="top"><a id="adfc9d74fc2b9a0356a44d1e41845b3de"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#adfc9d74fc2b9a0356a44d1e41845b3de">keepAlive</a> ()</td></tr>
<tr class="memdesc:adfc9d74fc2b9a0356a44d1e41845b3de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Call this (or <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#acdb29aa7095759101a9f33b79f863144" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> every 65.535 seconds or faster to keep the internal counter in sync with <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a>. <br /></td></tr>
<tr class="separator:adfc9d74fc2b9a0356a44d1e41845b3de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdb29aa7095759101a9f33b79f863144"><td class="memItemLeft" align="right" valign="top">acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#acdb29aa7095759101a9f33b79f863144">getNow</a> () const override</td></tr>
<tr class="memdesc:acdb29aa7095759101a9f33b79f863144"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z).  <a href="#acdb29aa7095759101a9f33b79f863144">More...</a><br /></td></tr>
<tr class="separator:acdb29aa7095759101a9f33b79f863144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa33cfb495e1b6247916b986bbef6875d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d">setNow</a> (acetime_t epochSeconds) override</td></tr>
<tr class="memdesc:aa33cfb495e1b6247916b986bbef6875d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time to the indicated seconds.  <a href="#aa33cfb495e1b6247916b986bbef6875d">More...</a><br /></td></tr>
<tr class="separator:aa33cfb495e1b6247916b986bbef6875d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea0bed257e52fe4e9ae93032ef7e4404"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404">sync</a> (acetime_t epochSeconds)</td></tr>
<tr class="memdesc:aea0bed257e52fe4e9ae93032ef7e4404"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper.  <a href="#aea0bed257e52fe4e9ae93032ef7e4404">More...</a><br /></td></tr>
<tr class="separator:aea0bed257e52fe4e9ae93032ef7e4404"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a18e2aa66cb889e64579da2e8dcdd5d"><td class="memItemLeft" align="right" valign="top">acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a0a18e2aa66cb889e64579da2e8dcdd5d">getLastSyncTime</a> () const</td></tr>
<tr class="memdesc:a0a18e2aa66cb889e64579da2e8dcdd5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call.  <a href="#a0a18e2aa66cb889e64579da2e8dcdd5d">More...</a><br /></td></tr>
<tr class="separator:a0a18e2aa66cb889e64579da2e8dcdd5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae02d0f3bcc25db646fe41edc5a424975"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#ae02d0f3bcc25db646fe41edc5a424975">isInit</a> () const</td></tr>
<tr class="memdesc:ae02d0f3bcc25db646fe41edc5a424975"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if initialized by <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d" title="Set the time to the indicated seconds. ">setNow()</a> or <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a>.  <a href="#ae02d0f3bcc25db646fe41edc5a424975">More...</a><br /></td></tr>
<tr class="separator:ae02d0f3bcc25db646fe41edc5a424975"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classace__time_1_1clock_1_1TimeProvider"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classace__time_1_1clock_1_1TimeProvider')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html">ace_time::clock::TimeProvider</a></td></tr>
<tr class="memitem:a28ed5580aeee22d8da3960e304b9075b inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#a28ed5580aeee22d8da3960e304b9075b">~TimeProvider</a> ()</td></tr>
<tr class="memdesc:a28ed5580aeee22d8da3960e304b9075b inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Virtual destructor.  <a href="classace__time_1_1clock_1_1TimeProvider.html#a28ed5580aeee22d8da3960e304b9075b">More...</a><br /></td></tr>
<tr class="separator:a28ed5580aeee22d8da3960e304b9075b inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28a580129c0b518ff79ae040dd506995 inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#a28a580129c0b518ff79ae040dd506995">sendRequest</a> () const</td></tr>
<tr class="memdesc:a28a580129c0b518ff79ae040dd506995 inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a time request asynchronously.  <a href="classace__time_1_1clock_1_1TimeProvider.html#a28a580129c0b518ff79ae040dd506995">More...</a><br /></td></tr>
<tr class="separator:a28a580129c0b518ff79ae040dd506995 inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a675396de08c217467f14f61d90b0f7fe inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#a675396de08c217467f14f61d90b0f7fe">isResponseReady</a> () const</td></tr>
<tr class="memdesc:a675396de08c217467f14f61d90b0f7fe inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if a response is ready.  <a href="classace__time_1_1clock_1_1TimeProvider.html#a675396de08c217467f14f61d90b0f7fe">More...</a><br /></td></tr>
<tr class="separator:a675396de08c217467f14f61d90b0f7fe inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa07602f28a900569b1359410b7523ec inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#afa07602f28a900569b1359410b7523ec">readResponse</a> () const</td></tr>
<tr class="memdesc:afa07602f28a900569b1359410b7523ec inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns number of seconds since AceTime epoch (2000-01-01).  <a href="classace__time_1_1clock_1_1TimeProvider.html#afa07602f28a900569b1359410b7523ec">More...</a><br /></td></tr>
<tr class="separator:afa07602f28a900569b1359410b7523ec inherit pub_methods_classace__time_1_1clock_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a821ac223df9233d771f59131cbd5ee22"><td class="memItemLeft" align="right" valign="top">virtual unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22">millis</a> () const</td></tr>
<tr class="memdesc:a821ac223df9233d771f59131cbd5ee22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the Arduino <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a>.  <a href="#a821ac223df9233d771f59131cbd5ee22">More...</a><br /></td></tr>
<tr class="separator:a821ac223df9233d771f59131cbd5ee22"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:aabb4fd7681b653a1840cab618085cca3"><td class="memItemLeft" align="right" valign="top"><a id="aabb4fd7681b653a1840cab618085cca3"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemClockSyncCoroutine</b></td></tr>
<tr class="separator:aabb4fd7681b653a1840cab618085cca3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea6deb3f61a0d398d6193775108e3017"><td class="memItemLeft" align="right" valign="top"><a id="aea6deb3f61a0d398d6193775108e3017"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemClockSyncLoop</b></td></tr>
<tr class="separator:aea6deb3f61a0d398d6193775108e3017"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_attribs_classace__time_1_1clock_1_1TimeProvider"><td colspan="2" onclick="javascript:toggleInherit('pub_static_attribs_classace__time_1_1clock_1_1TimeProvider')"><img src="closed.png" alt="-"/>&#160;Static Public Attributes inherited from <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html">ace_time::clock::TimeProvider</a></td></tr>
<tr class="memitem:a791a22630599219011317d07bd2255e6 inherit pub_static_attribs_classace__time_1_1clock_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top"><a id="a791a22630599219011317d07bd2255e6"></a>
static const acetime_t&#160;</td><td class="memItemRight" valign="bottom"><b>kInvalidSeconds</b> = LocalTime::kInvalidSeconds</td></tr>
<tr class="separator:a791a22630599219011317d07bd2255e6 inherit pub_static_attribs_classace__time_1_1clock_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A <a class="el" href="classace__time_1_1clock_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user. </p>
<p>The real time is returned as the number of seconds since the AceTime epoch of 2000-01-01T00:00:00Z.</p>
<p>The built-in <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a> is not accurate, so this class allows a periodic sync using the (presumably) more accurate syncTimeProvider. The current time can be periodically backed up into the backupTimeKeeper which is expected to be an RTC chip that continues to keep time during power loss.</p>
<p>The value of the previous system time <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a> is stored internally as a uint16_t. That has 2 advantages: 1) it saves memory, 2) the upper bound of the execution time of <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#acdb29aa7095759101a9f33b79f863144" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> limited to 65 iterations. The disadvantage is the that internal counter will rollover within 65.535 milliseconds. To prevent that, <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#adfc9d74fc2b9a0356a44d1e41845b3de" title="Call this (or getNow() every 65.535 seconds or faster to keep the internal counter in sync with milli...">keepAlive()</a> must be called more frequently than every 65.536 seconds. The easiest way to do this is to call it from the global loop() method.</p>
<p>There are 2 ways to perform syncing from the syncTimeProvider:</p>
<p>1) Create an instance of <a class="el" href="classace__time_1_1clock_1_1SystemClockSyncCoroutine.html" title="A coroutine that syncs the SystemClock with its mSyncTimeProvider. ">SystemClockSyncCoroutine</a> and register it with the CoroutineSchedule so that it runs periodically. The <a class="el" href="classace__time_1_1clock_1_1SystemClockSyncCoroutine.html#a849f4291836de179fb3aa611e25853fc">SystemClockSyncCoroutine::runCoroutine()</a> method uses the non-blocking <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#a28a580129c0b518ff79ae040dd506995" title="Send a time request asynchronously. ">sendRequest()</a>, <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#a675396de08c217467f14f61d90b0f7fe" title="Return true if a response is ready. ">isResponseReady()</a> and <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#afa07602f28a900569b1359410b7523ec" title="Returns number of seconds since AceTime epoch (2000-01-01). ">readResponse()</a> methods of <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end-user...">TimeProvider</a> to retrieve the current time. Some time providers (e.g. NtpTimeProvider) can take 100s of milliseconds to return, so using the coroutine infrastructure allows other coroutines to continue executing.</p>
<p>2) Call the <a class="el" href="classace__time_1_1clock_1_1SystemClockSyncLoop.html#af1bc8c275db5ecc7aeed66ff6848c4c6" title="Call this from the global loop() method. ">SystemClockSyncLoop::loop()</a> method from the global loop() function. This method uses the blocking <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#ab350cbeb3cf07545d570d16d45f38222" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">TimeProvider::getNow()</a> method which can take O(100) milliseconds for something like NtpTimeProvider. </p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00050">50</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a06a954f7d73ec2ad3138f38fcd8889d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06a954f7d73ec2ad3138f38fcd8889d2">&#9670;&nbsp;</a></span>SystemClock()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ace_time::clock::SystemClock::SystemClock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classace__time_1_1clock_1_1TimeProvider.html">TimeProvider</a> *&#160;</td>
          <td class="paramname"><em>syncTimeProvider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classace__time_1_1clock_1_1TimeKeeper.html">TimeKeeper</a> *&#160;</td>
          <td class="paramname"><em>backupTimeKeeper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">syncTimeProvider</td><td>The authoritative source of the time. Can be null in which case the objec relies just on <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a> and the user to set the proper time using <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d" title="Set the time to the indicated seconds. ">setNow()</a>. </td></tr>
    <tr><td class="paramname">backupTimeKeeper</td><td>An RTC chip which continues to keep time even when power is lost. Can be null. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00060">60</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0a18e2aa66cb889e64579da2e8dcdd5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a18e2aa66cb889e64579da2e8dcdd5d">&#9670;&nbsp;</a></span>getLastSyncTime()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">acetime_t ace_time::clock::SystemClock::getLastSyncTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call. </p>
<p>Returns 0 if never synced. </p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00128">128</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<a id="acdb29aa7095759101a9f33b79f863144"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acdb29aa7095759101a9f33b79f863144">&#9670;&nbsp;</a></span>getNow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">acetime_t ace_time::clock::SystemClock::getNow </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). </p>
<p>Returns kInvalidSeconds if an error has occured. </p>

<p>Implements <a class="el" href="classace__time_1_1clock_1_1TimeProvider.html#ab350cbeb3cf07545d570d16d45f38222">ace_time::clock::TimeProvider</a>.</p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00080">80</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<a id="ae02d0f3bcc25db646fe41edc5a424975"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae02d0f3bcc25db646fe41edc5a424975">&#9670;&nbsp;</a></span>isInit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ace_time::clock::SystemClock::isInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return true if initialized by <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d" title="Set the time to the indicated seconds. ">setNow()</a> or <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a>. </p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00133">133</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<a id="a821ac223df9233d771f59131cbd5ee22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a821ac223df9233d771f59131cbd5ee22">&#9670;&nbsp;</a></span>millis()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual unsigned long ace_time::clock::SystemClock::millis </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the Arduino <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#a821ac223df9233d771f59131cbd5ee22" title="Return the Arduino millis(). ">millis()</a>. </p>
<p>Override for unit testing. </p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00137">137</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<a id="aa33cfb495e1b6247916b986bbef6875d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa33cfb495e1b6247916b986bbef6875d">&#9670;&nbsp;</a></span>setNow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ace_time::clock::SystemClock::setNow </td>
          <td>(</td>
          <td class="paramtype">acetime_t&#160;</td>
          <td class="paramname"><em>epochSeconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the time to the indicated seconds. </p>
<p>Calling with a value of kInvalidSeconds indicates an error condition, so the method should do nothing. </p>

<p>Implements <a class="el" href="classace__time_1_1clock_1_1TimeKeeper.html#a7ee4d6e3b91ecb9d231836277b68e54d">ace_time::clock::TimeKeeper</a>.</p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00090">90</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<a id="aea0bed257e52fe4e9ae93032ef7e4404"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea0bed257e52fe4e9ae93032ef7e4404">&#9670;&nbsp;</a></span>sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ace_time::clock::SystemClock::sync </td>
          <td>(</td>
          <td class="paramtype">acetime_t&#160;</td>
          <td class="paramname"><em>epochSeconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Similar to <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aa33cfb495e1b6247916b986bbef6875d" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper. </p>
<p>This prevents us from retrieving the time from the RTC, then saving it right back again, with a drift each time it is saved back.</p>
<p>TODO: Implement a more graceful <a class="el" href="classace__time_1_1clock_1_1SystemClock.html#aea0bed257e52fe4e9ae93032ef7e4404" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> algorithm which shifts only a few milliseconds per iteration, and which guarantees that the clock never goes backwards in time. </p>

<p class="definition">Definition at line <a class="el" href="SystemClock_8h_source.html#l00110">110</a> of file <a class="el" href="SystemClock_8h_source.html">SystemClock.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/brian/dev/AceTime/src/ace_time/clock/<a class="el" href="SystemClock_8h_source.html">SystemClock.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
