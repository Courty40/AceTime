<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AceTime: ace_time::provider::SystemTimeKeeper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AceTime
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Date and time classes for Arduino that supports the  TZ DAtabase, and a system clock synchronized from an NTP server or an RTC chip.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>ace_time</b></li><li class="navelem"><b>provider</b></li><li class="navelem"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html">SystemTimeKeeper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classace__time_1_1provider_1_1SystemTimeKeeper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ace_time::provider::SystemTimeKeeper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A <a class="el" href="classace__time_1_1provider_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user.  
 <a href="classace__time_1_1provider_1_1SystemTimeKeeper.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ace_time::provider::SystemTimeKeeper:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1provider_1_1SystemTimeKeeper__inherit__graph.png" border="0" usemap="#ace__time_1_1provider_1_1SystemTimeKeeper_inherit__map" alt="Inheritance graph"/></div>
<map name="ace__time_1_1provider_1_1SystemTimeKeeper_inherit__map" id="ace__time_1_1provider_1_1SystemTimeKeeper_inherit__map">
<area shape="rect" id="node2" href="classace__time_1_1provider_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="12,95,153,136"/>
<area shape="rect" id="node3" href="classace__time_1_1provider_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="12,5,153,47"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ace_time::provider::SystemTimeKeeper:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1provider_1_1SystemTimeKeeper__coll__graph.png" border="0" usemap="#ace__time_1_1provider_1_1SystemTimeKeeper_coll__map" alt="Collaboration graph"/></div>
<map name="ace__time_1_1provider_1_1SystemTimeKeeper_coll__map" id="ace__time_1_1provider_1_1SystemTimeKeeper_coll__map">
<area shape="rect" id="node2" href="classace__time_1_1provider_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="12,95,153,136"/>
<area shape="rect" id="node3" href="classace__time_1_1provider_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="12,5,153,47"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a0e5c0eed900299c709147002d2270178"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a0e5c0eed900299c709147002d2270178">SystemTimeKeeper</a> (<a class="el" href="classace__time_1_1provider_1_1TimeProvider.html">TimeProvider</a> *syncTimeProvider, <a class="el" href="classace__time_1_1provider_1_1TimeKeeper.html">TimeKeeper</a> *backupTimeKeeper)</td></tr>
<tr class="separator:a0e5c0eed900299c709147002d2270178"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae97a6fe61821b1c5c72bde040853ffd9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae97a6fe61821b1c5c72bde040853ffd9"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>setup</b> ()</td></tr>
<tr class="separator:ae97a6fe61821b1c5c72bde040853ffd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b206a8a9e543fa5480cec12746d29b1"><td class="memItemLeft" align="right" valign="top">acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a7b206a8a9e543fa5480cec12746d29b1">getNow</a> () const override</td></tr>
<tr class="memdesc:a7b206a8a9e543fa5480cec12746d29b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z).  <a href="#a7b206a8a9e543fa5480cec12746d29b1">More...</a><br /></td></tr>
<tr class="separator:a7b206a8a9e543fa5480cec12746d29b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a598f944877e6dad3d36f270b8813d8df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df">setNow</a> (acetime_t epochSeconds) override</td></tr>
<tr class="memdesc:a598f944877e6dad3d36f270b8813d8df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time to the indicated seconds.  <a href="#a598f944877e6dad3d36f270b8813d8df">More...</a><br /></td></tr>
<tr class="separator:a598f944877e6dad3d36f270b8813d8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f67c7e3aa20b38b8b31c7ce1c8d6535"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535">sync</a> (acetime_t epochSeconds)</td></tr>
<tr class="memdesc:a4f67c7e3aa20b38b8b31c7ce1c8d6535"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper.  <a href="#a4f67c7e3aa20b38b8b31c7ce1c8d6535">More...</a><br /></td></tr>
<tr class="separator:a4f67c7e3aa20b38b8b31c7ce1c8d6535"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01cfd828f3b64d0942ead5a4de13ad06"><td class="memItemLeft" align="right" valign="top">acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a01cfd828f3b64d0942ead5a4de13ad06">getLastSyncTime</a> () const </td></tr>
<tr class="memdesc:a01cfd828f3b64d0942ead5a4de13ad06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call.  <a href="#a01cfd828f3b64d0942ead5a4de13ad06">More...</a><br /></td></tr>
<tr class="separator:a01cfd828f3b64d0942ead5a4de13ad06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f0580ae7a4257d5927417f74c4b6611"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a2f0580ae7a4257d5927417f74c4b6611">isInit</a> () const </td></tr>
<tr class="memdesc:a2f0580ae7a4257d5927417f74c4b6611"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if initialized by <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a> or <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a>.  <a href="#a2f0580ae7a4257d5927417f74c4b6611">More...</a><br /></td></tr>
<tr class="separator:a2f0580ae7a4257d5927417f74c4b6611"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classace__time_1_1provider_1_1TimeProvider"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classace__time_1_1provider_1_1TimeProvider')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html">ace_time::provider::TimeProvider</a></td></tr>
<tr class="memitem:aa93803e189686e76c61ee6197480edb4 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#aa93803e189686e76c61ee6197480edb4">~TimeProvider</a> ()</td></tr>
<tr class="memdesc:aa93803e189686e76c61ee6197480edb4 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Virtual destructor.  <a href="#aa93803e189686e76c61ee6197480edb4">More...</a><br /></td></tr>
<tr class="separator:aa93803e189686e76c61ee6197480edb4 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a669d13c2977808090721f0df0d164871 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a669d13c2977808090721f0df0d164871">sendRequest</a> () const </td></tr>
<tr class="memdesc:a669d13c2977808090721f0df0d164871 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a time request asynchronously.  <a href="#a669d13c2977808090721f0df0d164871">More...</a><br /></td></tr>
<tr class="separator:a669d13c2977808090721f0df0d164871 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4ce62a1803b8e3734cbeac4e68b3287 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#ac4ce62a1803b8e3734cbeac4e68b3287">isResponseReady</a> () const </td></tr>
<tr class="memdesc:ac4ce62a1803b8e3734cbeac4e68b3287 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if a response is ready.  <a href="#ac4ce62a1803b8e3734cbeac4e68b3287">More...</a><br /></td></tr>
<tr class="separator:ac4ce62a1803b8e3734cbeac4e68b3287 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e5f8829f6b2823028d960fcdd77a371 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual acetime_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a5e5f8829f6b2823028d960fcdd77a371">readResponse</a> () const </td></tr>
<tr class="memdesc:a5e5f8829f6b2823028d960fcdd77a371 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns number of seconds since AceTime epoch (2000-01-01).  <a href="#a5e5f8829f6b2823028d960fcdd77a371">More...</a><br /></td></tr>
<tr class="separator:a5e5f8829f6b2823028d960fcdd77a371 inherit pub_methods_classace__time_1_1provider_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a77be038a230262d27725a8751e8cb807"><td class="memItemLeft" align="right" valign="top">virtual unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807">millis</a> () const </td></tr>
<tr class="memdesc:a77be038a230262d27725a8751e8cb807"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the Arduino <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a>.  <a href="#a77be038a230262d27725a8751e8cb807">More...</a><br /></td></tr>
<tr class="separator:a77be038a230262d27725a8751e8cb807"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:acbdc07eb6e82f0488241e116a7fff772"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acbdc07eb6e82f0488241e116a7fff772"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemTimeSyncCoroutine</b></td></tr>
<tr class="separator:acbdc07eb6e82f0488241e116a7fff772"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a651be9d16a8db6257d07f8efcebc2499"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a651be9d16a8db6257d07f8efcebc2499"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemTimeSyncLoop</b></td></tr>
<tr class="separator:a651be9d16a8db6257d07f8efcebc2499"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="inherited"></a>
Additional Inherited Members</h2></td></tr>
<tr class="inherit_header pub_static_attribs_classace__time_1_1provider_1_1TimeProvider"><td colspan="2" onclick="javascript:toggleInherit('pub_static_attribs_classace__time_1_1provider_1_1TimeProvider')"><img src="closed.png" alt="-"/>&#160;Static Public Attributes inherited from <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html">ace_time::provider::TimeProvider</a></td></tr>
<tr class="memitem:a22f6aa8c4dc64415ecdf45db38c37a47 inherit pub_static_attribs_classace__time_1_1provider_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a22f6aa8c4dc64415ecdf45db38c37a47"></a>
static const acetime_t&#160;</td><td class="memItemRight" valign="bottom"><b>kInvalidSeconds</b> = INT32_MAX</td></tr>
<tr class="separator:a22f6aa8c4dc64415ecdf45db38c37a47 inherit pub_static_attribs_classace__time_1_1provider_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A <a class="el" href="classace__time_1_1provider_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user. </p>
<p>The real time is returned as the number of seconds since the AceTime epoch of 2000-01-01T00:00:00Z.</p>
<p>The built-in <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a> is not accurate, so this class allows a periodic sync using the (presumably) more accurate syncTimeProvider. The current time can be periodically backed up into the backupTimeKeeper which is expected to be an RTC chip that continues to keep time during power loss.</p>
<p>The value of the previous system time <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a> is stored internally as a uint16_t. That has 2 advantages: 1) it saves memory, 2) the upper bound of the execution time of <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a7b206a8a9e543fa5480cec12746d29b1" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> limited to 65 iterations. The disadvantage is the that internal counter will rollover within 65.535 milliseconds. To prevent that, <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a7b206a8a9e543fa5480cec12746d29b1" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> or <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a> must be called more frequently than every 65.536 seconds. This can be satisfied by using the <a class="el" href="classace__time_1_1provider_1_1SystemTimeHeartbeatCoroutine.html" title="A coroutine that calls SystemTimeKeeper.getNow() peridically. ">SystemTimeHeartbeatCoroutine</a> or <a class="el" href="classace__time_1_1provider_1_1SystemTimeHeartbeatLoop.html" title="A class that peridically freshens the SystemTimeKeeper using the heartbeat call to getNow()...">SystemTimeHeartbeatLoop</a> helper classes.</p>
<p>There are 2 ways to perform syncing from the syncTimeProvider:</p>
<p>1) Create an instance of <a class="el" href="classace__time_1_1provider_1_1SystemTimeSyncCoroutine.html" title="A coroutine that syncs the SystemTimeKeeper with its syncTimeProvider. ">SystemTimeSyncCoroutine</a> and register it with the CoroutineSchedule so that it runs periodically. The <a class="el" href="classace__time_1_1provider_1_1SystemTimeSyncCoroutine.html#a4e379fecd267d117b78d95acb120f0df">SystemTimeSyncCoroutine::runCoroutine()</a> method uses the non-blocking <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a669d13c2977808090721f0df0d164871" title="Send a time request asynchronously. ">sendRequest()</a>, <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#ac4ce62a1803b8e3734cbeac4e68b3287" title="Return true if a response is ready. ">isResponseReady()</a> and <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a5e5f8829f6b2823028d960fcdd77a371" title="Returns number of seconds since AceTime epoch (2000-01-01). ">readResponse()</a> methods of <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end-user...">TimeProvider</a> to retrieve the current time. Some time providers (e.g. NtpTimeProvider) can take 100s of milliseconds to return, so using the coroutine infrastructure allows other coroutines to continue executing.</p>
<p>2) Call the <a class="el" href="classace__time_1_1provider_1_1SystemTimeSyncLoop.html#a4fc669fcd4b23db23b784189f7890e4d" title="If AceRoutine coroutine infrastructure is not used, then call this from the global loop() method...">SystemTimeSyncLoop::loop()</a> method from the global loop() function. This method uses the blocking <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a3eb75fa2b83b003e009eb596924cc1b2" title="Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). ">TimeProvider::getNow()</a> method which can take O(100) milliseconds for something like NtpTimeProvider. </p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00045">45</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a0e5c0eed900299c709147002d2270178"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ace_time::provider::SystemTimeKeeper::SystemTimeKeeper </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classace__time_1_1provider_1_1TimeProvider.html">TimeProvider</a> *&#160;</td>
          <td class="paramname"><em>syncTimeProvider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classace__time_1_1provider_1_1TimeKeeper.html">TimeKeeper</a> *&#160;</td>
          <td class="paramname"><em>backupTimeKeeper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">syncTimeProvider</td><td>The authoritative source of the time. Can be null in which case the objec relies just on <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a> and the user to set the proper time using <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a>. </td></tr>
    <tr><td class="paramname">backupTimeKeeper</td><td>An RTC chip which continues to keep time even when power is lost. Can be null. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00055">55</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a01cfd828f3b64d0942ead5a4de13ad06"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">acetime_t ace_time::provider::SystemTimeKeeper::getLastSyncTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call. </p>
<p>Returns 0 if never synced. </p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00114">114</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a class="anchor" id="a7b206a8a9e543fa5480cec12746d29b1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">acetime_t ace_time::provider::SystemTimeKeeper::getNow </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of seconds since the AceTime epoch (2000-01-01T00:00:00Z). </p>
<p>Returns kInvalidSeconds if an error has occured. </p>

<p>Implements <a class="el" href="classace__time_1_1provider_1_1TimeProvider.html#a3eb75fa2b83b003e009eb596924cc1b2">ace_time::provider::TimeProvider</a>.</p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00067">67</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a class="anchor" id="a2f0580ae7a4257d5927417f74c4b6611"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ace_time::provider::SystemTimeKeeper::isInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return true if initialized by <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a> or <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a>. </p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00119">119</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a class="anchor" id="a77be038a230262d27725a8751e8cb807"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual unsigned long ace_time::provider::SystemTimeKeeper::millis </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the Arduino <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a77be038a230262d27725a8751e8cb807" title="Return the Arduino millis(). ">millis()</a>. </p>
<p>Override for unit testing. </p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00123">123</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a class="anchor" id="a598f944877e6dad3d36f270b8813d8df"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ace_time::provider::SystemTimeKeeper::setNow </td>
          <td>(</td>
          <td class="paramtype">acetime_t&#160;</td>
          <td class="paramname"><em>epochSeconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the time to the indicated seconds. </p>
<p>Calling with a value of kInvalidSeconds indicates an error condition, so the method should do nothing. </p>

<p>Implements <a class="el" href="classace__time_1_1provider_1_1TimeKeeper.html#a90e23ad1598a480be3693736dab9d65b">ace_time::provider::TimeKeeper</a>.</p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00077">77</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a class="anchor" id="a4f67c7e3aa20b38b8b31c7ce1c8d6535"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ace_time::provider::SystemTimeKeeper::sync </td>
          <td>(</td>
          <td class="paramtype">acetime_t&#160;</td>
          <td class="paramname"><em>epochSeconds</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Similar to <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a598f944877e6dad3d36f270b8813d8df" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper. </p>
<p>This prevents us from retrieving the time from the RTC, then saving it right back again, with a drift each time it is saved back.</p>
<p>TODO: Implement a more graceful <a class="el" href="classace__time_1_1provider_1_1SystemTimeKeeper.html#a4f67c7e3aa20b38b8b31c7ce1c8d6535" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> algorithm which shifts only a few milliseconds per iteration, and which guarantees that the clock never goes backwards in time. </p>

<p>Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00096">96</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/brian/dev/AceTime/src/ace_time/provider/<a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
