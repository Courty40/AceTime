<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AceTime: ace_time::SystemTimeKeeper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AceTime
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">Date and time classes for Arduino with basic time zone support using offsets from UTC, and system clock synchronized from NTP server or RTC chip.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><b>ace_time</b></li><li class="navelem"><a class="el" href="classace__time_1_1SystemTimeKeeper.html">SystemTimeKeeper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#friends">Friends</a> &#124;
<a href="classace__time_1_1SystemTimeKeeper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ace_time::SystemTimeKeeper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>A <a class="el" href="classace__time_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user.  
 <a href="classace__time_1_1SystemTimeKeeper.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for ace_time::SystemTimeKeeper:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1SystemTimeKeeper__inherit__graph.png" border="0" usemap="#ace__time_1_1SystemTimeKeeper_inherit__map" alt="Inheritance graph"/></div>
<map name="ace__time_1_1SystemTimeKeeper_inherit__map" id="ace__time_1_1SystemTimeKeeper_inherit__map">
<area shape="rect" id="node2" href="classace__time_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="28,80,181,107"/>
<area shape="rect" id="node3" href="classace__time_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="25,5,185,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for ace_time::SystemTimeKeeper:</div>
<div class="dyncontent">
<div class="center"><img src="classace__time_1_1SystemTimeKeeper__coll__graph.png" border="0" usemap="#ace__time_1_1SystemTimeKeeper_coll__map" alt="Collaboration graph"/></div>
<map name="ace__time_1_1SystemTimeKeeper_coll__map" id="ace__time_1_1SystemTimeKeeper_coll__map">
<area shape="rect" id="node2" href="classace__time_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end&#45;user. " alt="" coords="28,80,181,107"/>
<area shape="rect" id="node3" href="classace__time_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end&#45;user..." alt="" coords="25,5,185,32"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3a2fe8b770258b936de8aea9004d799e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#a3a2fe8b770258b936de8aea9004d799e">SystemTimeKeeper</a> (<a class="el" href="classace__time_1_1TimeProvider.html">TimeProvider</a> *syncTimeProvider, <a class="el" href="classace__time_1_1TimeKeeper.html">TimeKeeper</a> *backupTimeKeeper)</td></tr>
<tr class="separator:a3a2fe8b770258b936de8aea9004d799e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa5ddca262312714a78eaf6c0ef043c59"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#aa5ddca262312714a78eaf6c0ef043c59">setup</a> () override</td></tr>
<tr class="memdesc:aa5ddca262312714a78eaf6c0ef043c59"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the time keeper.  <a href="#aa5ddca262312714a78eaf6c0ef043c59">More...</a><br /></td></tr>
<tr class="separator:aa5ddca262312714a78eaf6c0ef043c59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e3e1cff22e11ecee3d29cf9383a2cc"><td class="memItemLeft" align="right" valign="top">virtual uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#ab7e3e1cff22e11ecee3d29cf9383a2cc">getNow</a> () const override</td></tr>
<tr class="memdesc:ab7e3e1cff22e11ecee3d29cf9383a2cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the number of seconds since the <a class="el" href="classace__time_1_1DateTime.html" title="The date (year, month, day) and time (hour, minute, second) fields representing an instant in time...">DateTime</a> epoch (2000-01-01T00:00:00Z).  <a href="#ab7e3e1cff22e11ecee3d29cf9383a2cc">More...</a><br /></td></tr>
<tr class="separator:ab7e3e1cff22e11ecee3d29cf9383a2cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dbca3a4a2d94c5b374a90d4e38cae5c"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#a2dbca3a4a2d94c5b374a90d4e38cae5c">setNow</a> (uint32_t secondsSinceEpoch) override</td></tr>
<tr class="memdesc:a2dbca3a4a2d94c5b374a90d4e38cae5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the time to the indicated seconds.  <a href="#a2dbca3a4a2d94c5b374a90d4e38cae5c">More...</a><br /></td></tr>
<tr class="separator:a2dbca3a4a2d94c5b374a90d4e38cae5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa66d2531c8f384e59ebe87ab263667a0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#aa66d2531c8f384e59ebe87ab263667a0">sync</a> (uint32_t secondsSinceEpoch)</td></tr>
<tr class="memdesc:aa66d2531c8f384e59ebe87ab263667a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a2dbca3a4a2d94c5b374a90d4e38cae5c" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper.  <a href="#aa66d2531c8f384e59ebe87ab263667a0">More...</a><br /></td></tr>
<tr class="separator:aa66d2531c8f384e59ebe87ab263667a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1511116ed49c00827b79bfd67291fdc2"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#a1511116ed49c00827b79bfd67291fdc2">getLastSyncTime</a> () const</td></tr>
<tr class="memdesc:a1511116ed49c00827b79bfd67291fdc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1SystemTimeKeeper.html#aa66d2531c8f384e59ebe87ab263667a0" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call.  <a href="#a1511116ed49c00827b79bfd67291fdc2">More...</a><br /></td></tr>
<tr class="separator:a1511116ed49c00827b79bfd67291fdc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_classace__time_1_1TimeProvider"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_classace__time_1_1TimeProvider')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="classace__time_1_1TimeProvider.html">ace_time::TimeProvider</a></td></tr>
<tr class="memitem:a2f4920788141f185ad1e5beeecd37fc3 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1TimeProvider.html#a2f4920788141f185ad1e5beeecd37fc3">~TimeProvider</a> ()</td></tr>
<tr class="memdesc:a2f4920788141f185ad1e5beeecd37fc3 inherit pub_methods_classace__time_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Virtual destructor.  <a href="classace__time_1_1TimeProvider.html#a2f4920788141f185ad1e5beeecd37fc3">More...</a><br /></td></tr>
<tr class="separator:a2f4920788141f185ad1e5beeecd37fc3 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac18713fb8196b179433de8553ff77e18 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1TimeProvider.html#ac18713fb8196b179433de8553ff77e18">sendRequest</a> () const</td></tr>
<tr class="memdesc:ac18713fb8196b179433de8553ff77e18 inherit pub_methods_classace__time_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a time request asynchronously.  <a href="classace__time_1_1TimeProvider.html#ac18713fb8196b179433de8553ff77e18">More...</a><br /></td></tr>
<tr class="separator:ac18713fb8196b179433de8553ff77e18 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a760298b6828a9da8273b9c7b888de615 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1TimeProvider.html#a760298b6828a9da8273b9c7b888de615">isResponseReady</a> () const</td></tr>
<tr class="memdesc:a760298b6828a9da8273b9c7b888de615 inherit pub_methods_classace__time_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if a response is ready.  <a href="classace__time_1_1TimeProvider.html#a760298b6828a9da8273b9c7b888de615">More...</a><br /></td></tr>
<tr class="separator:a760298b6828a9da8273b9c7b888de615 inherit pub_methods_classace__time_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a091ab9aa2465d08751d9f0cccee6b55e inherit pub_methods_classace__time_1_1TimeProvider"><td class="memItemLeft" align="right" valign="top">virtual uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1TimeProvider.html#a091ab9aa2465d08751d9f0cccee6b55e">readResponse</a> () const</td></tr>
<tr class="memdesc:a091ab9aa2465d08751d9f0cccee6b55e inherit pub_methods_classace__time_1_1TimeProvider"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns number of seconds since AceTime epoch (2000-01-01).  <a href="classace__time_1_1TimeProvider.html#a091ab9aa2465d08751d9f0cccee6b55e">More...</a><br /></td></tr>
<tr class="separator:a091ab9aa2465d08751d9f0cccee6b55e inherit pub_methods_classace__time_1_1TimeProvider"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a55de283ac9b57919f8b646606cb6bcae"><td class="memItemLeft" align="right" valign="top">virtual unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae">millis</a> () const</td></tr>
<tr class="memdesc:a55de283ac9b57919f8b646606cb6bcae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the Arduino <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a>.  <a href="#a55de283ac9b57919f8b646606cb6bcae">More...</a><br /></td></tr>
<tr class="separator:a55de283ac9b57919f8b646606cb6bcae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="friends"></a>
Friends</h2></td></tr>
<tr class="memitem:acbdc07eb6e82f0488241e116a7fff772"><td class="memItemLeft" align="right" valign="top"><a id="acbdc07eb6e82f0488241e116a7fff772"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemTimeSyncCoroutine</b></td></tr>
<tr class="separator:acbdc07eb6e82f0488241e116a7fff772"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38a02e729ba00ce1d11dd4742040b419"><td class="memItemLeft" align="right" valign="top"><a id="a38a02e729ba00ce1d11dd4742040b419"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemTimeHeartbeatCoroutine</b></td></tr>
<tr class="separator:a38a02e729ba00ce1d11dd4742040b419"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bf03e5c8bc7117fa945462931457ede"><td class="memItemLeft" align="right" valign="top"><a id="a7bf03e5c8bc7117fa945462931457ede"></a>
class&#160;</td><td class="memItemRight" valign="bottom"><b>SystemTimeLoop</b></td></tr>
<tr class="separator:a7bf03e5c8bc7117fa945462931457ede"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A <a class="el" href="classace__time_1_1TimeKeeper.html" title="A TimeProvider whose time can be set by the end-user. ">TimeKeeper</a> that uses the Arduino <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a> function to advance the time returned to the user. </p>
<p>The real time is returned as the number of seconds since the AceTime epoch of 2000-01-01T00:00:00Z.</p>
<p>The built-in <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a> is not accurate, so this class allows a periodic sync using the (presumably) more accurate syncTimeProvider. The current time can be periodically backed up into the backupTimeKeeper which is expected to be an RTC chip that continues to keep time during power loss.</p>
<p>The value of the previous system time <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a> is stored internally as a uint16_t. That has 2 advantages: 1) it saves memory, 2) the upper bound of the execution time of <a class="el" href="classace__time_1_1SystemTimeKeeper.html#ab7e3e1cff22e11ecee3d29cf9383a2cc" title="Return the number of seconds since the DateTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> limited to 65 iterations. The disadvantage is the that internal counter will rollover within 65.535 milliseconds. To prevent that, <a class="el" href="classace__time_1_1SystemTimeKeeper.html#ab7e3e1cff22e11ecee3d29cf9383a2cc" title="Return the number of seconds since the DateTime epoch (2000-01-01T00:00:00Z). ">getNow()</a> or <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a2dbca3a4a2d94c5b374a90d4e38cae5c" title="Set the time to the indicated seconds. ">setNow()</a> must be called more frequently than every 65.536 seconds. This can be satisfied by using the SystemTimeHeartbeatCoroutine or <a class="el" href="classace__time_1_1SystemTimeLoop.html" title="A class that peridically freshens the SystemTimeKeeper using the heartbeat call to getNow()...">SystemTimeLoop</a> helper classes.</p>
<p>There are 2 ways to perform syncing from the syncTimeProvider:</p>
<p>1) Create an instance of SystemTimeSyncCoroutine and register it with the CoroutineSchedule so that it runs periodically. The SystemTimeSyncCoroutine::runCoroutine() method uses the non-blocking <a class="el" href="classace__time_1_1TimeProvider.html#ac18713fb8196b179433de8553ff77e18" title="Send a time request asynchronously. ">sendRequest()</a>, <a class="el" href="classace__time_1_1TimeProvider.html#a760298b6828a9da8273b9c7b888de615" title="Return true if a response is ready. ">isResponseReady()</a> and <a class="el" href="classace__time_1_1TimeProvider.html#a091ab9aa2465d08751d9f0cccee6b55e" title="Returns number of seconds since AceTime epoch (2000-01-01). ">readResponse()</a> methods of <a class="el" href="classace__time_1_1TimeProvider.html" title="Base class for objects that provide a source of time whose time cannot be changed by the end-user...">TimeProvider</a> to retrieve the current time. Some time providers (e.g. NtpTimeProvider) can take 100s of milliseconds to return, so using the coroutine infrastructure allows other coroutines to continue executing.</p>
<p>2) Call the <a class="el" href="classace__time_1_1SystemTimeLoop.html#ac364fe3dd764adba2660fa70ca4b440e" title="If AceRoutine coroutine infrastructure is not used, then call this from the global loop() method...">SystemTimeLoop::loop()</a> method from the global loop() function. This method uses the blocking <a class="el" href="classace__time_1_1TimeProvider.html#a39938f64c60237118dbce957e80a03de" title="Return the number of seconds since the DateTime epoch (2000-01-01T00:00:00Z). ">TimeProvider::getNow()</a> method which can take 100s milliseconds for something like NtpTimeProvider.</p>
<p>The <a class="el" href="classace__time_1_1SystemTimeLoop.html#ac364fe3dd764adba2660fa70ca4b440e" title="If AceRoutine coroutine infrastructure is not used, then call this from the global loop() method...">SystemTimeLoop::loop()</a> performs both syncing (against the syncTimeProvider) and heartbeat freshening (against the builtin <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a>). If you are using Coroutines, you must use both the SystemTimeHeartbeatCoroutine and the SystemTimeSyncCoroutine. </p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00053">53</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a3a2fe8b770258b936de8aea9004d799e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a2fe8b770258b936de8aea9004d799e">&#9670;&nbsp;</a></span>SystemTimeKeeper()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ace_time::SystemTimeKeeper::SystemTimeKeeper </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classace__time_1_1TimeProvider.html">TimeProvider</a> *&#160;</td>
          <td class="paramname"><em>syncTimeProvider</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classace__time_1_1TimeKeeper.html">TimeKeeper</a> *&#160;</td>
          <td class="paramname"><em>backupTimeKeeper</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">syncTimeProvider</td><td>The authoritative source of the time. Can be null in which case the objec relies just on <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a> and the user to set the proper time using <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a2dbca3a4a2d94c5b374a90d4e38cae5c" title="Set the time to the indicated seconds. ">setNow()</a>. </td></tr>
    <tr><td class="paramname">backupTimeKeeper</td><td>An RTC chip which continues to keep time even when power is lost. Can be null. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00063">63</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a1511116ed49c00827b79bfd67291fdc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1511116ed49c00827b79bfd67291fdc2">&#9670;&nbsp;</a></span>getLastSyncTime()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t ace_time::SystemTimeKeeper::getLastSyncTime </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the time (seconds since Epoch) of the last valid <a class="el" href="classace__time_1_1SystemTimeKeeper.html#aa66d2531c8f384e59ebe87ab263667a0" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> call. </p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00119">119</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a id="ab7e3e1cff22e11ecee3d29cf9383a2cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab7e3e1cff22e11ecee3d29cf9383a2cc">&#9670;&nbsp;</a></span>getNow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual uint32_t ace_time::SystemTimeKeeper::getNow </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the number of seconds since the <a class="el" href="classace__time_1_1DateTime.html" title="The date (year, month, day) and time (hour, minute, second) fields representing an instant in time...">DateTime</a> epoch (2000-01-01T00:00:00Z). </p>
<p>Some TimeProviders will return a 0 to indicate an error has occured. </p>

<p>Implements <a class="el" href="classace__time_1_1TimeProvider.html#a39938f64c60237118dbce957e80a03de">ace_time::TimeProvider</a>.</p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00075">75</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a id="a55de283ac9b57919f8b646606cb6bcae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55de283ac9b57919f8b646606cb6bcae">&#9670;&nbsp;</a></span>millis()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual unsigned long ace_time::SystemTimeKeeper::millis </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the Arduino <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a55de283ac9b57919f8b646606cb6bcae" title="Return the Arduino millis(). ">millis()</a>. </p>
<p>Override for unit testing. </p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00125">125</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a id="a2dbca3a4a2d94c5b374a90d4e38cae5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dbca3a4a2d94c5b374a90d4e38cae5c">&#9670;&nbsp;</a></span>setNow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ace_time::SystemTimeKeeper::setNow </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>secondsSinceEpoch</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set the time to the indicated seconds. </p>
<p>Calling with a value of 0 indicates an error condition, so the method should do nothing. </p>

<p>Implements <a class="el" href="classace__time_1_1TimeKeeper.html#a02c57bf641b0f601541b8381f4027077">ace_time::TimeKeeper</a>.</p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00085">85</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a id="aa5ddca262312714a78eaf6c0ef043c59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5ddca262312714a78eaf6c0ef043c59">&#9670;&nbsp;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ace_time::SystemTimeKeeper::setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Setup the time keeper. </p>

<p>Implements <a class="el" href="classace__time_1_1TimeProvider.html#a084f3c9df1911b08cd9bf1304d3349dc">ace_time::TimeProvider</a>.</p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00069">69</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<a id="aa66d2531c8f384e59ebe87ab263667a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa66d2531c8f384e59ebe87ab263667a0">&#9670;&nbsp;</a></span>sync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ace_time::SystemTimeKeeper::sync </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>secondsSinceEpoch</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Similar to <a class="el" href="classace__time_1_1SystemTimeKeeper.html#a2dbca3a4a2d94c5b374a90d4e38cae5c" title="Set the time to the indicated seconds. ">setNow()</a> except that backupNow() is called only if the backupTimeKeeper is different from the syncTimeKeeper. </p>
<p>This prevents us from retrieving the time from the RTC, then saving it right back again, with a drift each time it is saved back.</p>
<p>TODO: Implement a more graceful <a class="el" href="classace__time_1_1SystemTimeKeeper.html#aa66d2531c8f384e59ebe87ab263667a0" title="Similar to setNow() except that backupNow() is called only if the backupTimeKeeper is different from ...">sync()</a> algorithm which shifts only a few milliseconds per iteration, and which guarantees that the clock never goes backwards in time. </p>

<p class="definition">Definition at line <a class="el" href="SystemTimeKeeper_8h_source.html#l00104">104</a> of file <a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/home/brian/dev/AceTime/src/ace_time/<a class="el" href="SystemTimeKeeper_8h_source.html">SystemTimeKeeper.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
